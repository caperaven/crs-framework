import{tokenize as u}from"./exp-tokenizer.js";const d=["false","true","null"];async function O(e,t="context"){let s=!1;if(typeof e=="string"&&e.indexOf("$html")!=-1&&(s=!0,e=e.split("$html.").join("")),e==null||e=="null"||e=="undefined"||d.indexOf(e.toString())!=-1||isNaN(e)==!1||e.trim()==t)return{isLiteral:!0,expression:e,isHTML:s};if(t!="context"==!0&&e==["${",t,"}"].join(""))return{isLiteral:!0,expression:e};const a=new Set,r=e.indexOf("${")!=-1||e.indexOf("&{")!=-1,f=u(e,r),i=[];for(let n of f)n.type=="property"?(n.value.indexOf("$globals")!=-1?i.push(n.value.replace("$globals","crs.binding.data.globals")):n.value.indexOf("$event")!=-1?i.push(n.value.replace("$event","event")):n.value.indexOf("$context")!=-1?i.push(n.value.replace("$context","context")):n.value.indexOf("$data")!=-1?i.push(n.value.replace("$data","crs.binding.data.getValue")):n.value.indexOf("$parent")!=-1?i.push(n.value.replace("$parent","parent")):t!=="context"&&n.value.indexOf(`${t}.`)!=-1||n.value==="new"?i.push(n.value):i.push(`${t}.${n.value}`),v(a,n.value,t)):i.push(n.value);let o=i.join("").replaceAll("context.[","[").replaceAll("context.]","]");return o=await crs.binding.expression.translateFactory(o),{isLiteral:r,isHTML:s,expression:o,properties:Array.from(a)}}const c=[".trim",".toLowerCase","toUpperCase"],p=["$data","$event","[","]"];function v(e,t,s){if(t.length==0)return;for(let r of p)if(t.indexOf(r)!=-1)return;let l=t;const a=`${s}.`;l.indexOf(a)==0&&(l=l.replace(a,""));for(let r of c)l.indexOf(r)!=-1&&(l=l.split(r).join(""));e.add(l)}export{O as sanitize};
