class f{static async perform(e,a,t,n){await this[e.action](e,a,t,n)}static async load(e,a,t,n){if(await crs.process.getValue(e.args.dialog,a,t,n)==!0){const s=await p(e);let o=[];for(const i of s){const c=await d(i.name);o.push({name:c.name,ext:c.ext,type:i.type,size:i.size,value:i})}return e.args.target!=null&&await crs.process.setValue(e.args.target,o,a,t,n),o}else{const s=await h(e,a,t,n);return e.args.target!=null&&await crs.process.setValue(e.args.target,s,a,t,n),s}}static async save(e,a,t,n){const l=await crs.process.getValue(e.args.details,a,t,n);let s=document.createElement("a");s.style.display="none",document.body.appendChild(s);for(let o of l){let i=new Blob([o.value],{type:o.type}),c=window.URL.createObjectURL(i);s.href=c,s.download=`${o.name}.${o.ext}`,s.click(),window.URL.revokeObjectURL(c),c=null,i=null}s.parentElement.removeChild(s),s=null}static async save_canvas(e,a,t,n){const l=await crs.dom.get_element(e.args.source),s=await crs.process.getValue(e.args.name,a,t,n)||"image",o=l.toDataURL("image/png");let i=document.createElement("a");i.style.display="none",document.body.appendChild(i),i.href=o.replace("image/png","image/octet-stream"),i.download=`${s}.png`,i.click(),i.parentElement.removeChild(i),i=null}static async enable_dropzone(e,a,t,n){const l=await crs.dom.get_element(e.args.element,a,t,n),s=await crs.process.getValue(e.args.callback,a,t,n),o=await crs.process.getValue(e.args.drop_template,a,t,n),i=await crs.process.getValue(e.args.drop_classes,a,t,n);l.addEventListener("drop",m),l.addEventListener("dragenter",g),l.addEventListener("dragover",u),l.addEventListener("dragleave",_),l.__callback=s,l.__dropTemplate=o,l.__highlighted=!1,l.__dropClasses=i}static async disable_dropzone(e,a,t,n){const l=await crs.dom.get_element(e.args.element,a,t,n);l.removeEventListener("drop",m),l.removeEventListener("dragenter",g),l.removeEventListener("dragover",u),l.removeEventListener("dragleave",_),await crs.call("dom_interactive","remove_animation_layer"),delete l.__callback,delete l.__dropTemplate,delete l.__highlighted,delete l.__dropClasses,delete l.__dropBounds}}class y{static async blob(e){return new Promise(a=>{const t=new FileReader;t.onload=()=>{t.onload=null,a(t.result)},t.readAsArrayBuffer(e)})}}async function d(r){const e=r.split("/"),t=e[e.length-1].split("."),n=t[t.length-1];return{name:t[0],ext:n}}async function p(){return new Promise(r=>{let e=document.createElement("input");e.type="file",e.setAttribute("multiple","multiple"),e.onchange=()=>{e.onchange=null;const a=Array.from(e.files);r(a)},e.click()})}async function h(r,e,a,t){const n=await crs.process.getValue(r.args.files,e,a,t),l=[];for(const s of n){const o=await d(s);l.push({name:o.name,ext:o.ext,value:await fetch(s).then(i=>i.blob())})}return l}async function g(r){r.preventDefault();const e=r.currentTarget;e.__highlighted!==!0&&(await crs.call("dom_interactive","highlight",{target:e,template:e.__dropTemplate,classes:e.__dropClasses}),e.__highlighted=!0),e.__dropBounds=e.getBoundingClientRect(),e.__callback({action:"dragEnter",event:r})}async function u(r){r.preventDefault()}async function _(r){r.preventDefault();const e=r.currentTarget,a=r.currentTarget.__dropBounds;a!=null&&(r.x>=a.left&&r.x<=a.right&&r.y>=a.top&&r.y<=a.bottom||(await crs.call("dom_interactive","remove_animation_layer"),e.__highlighted=!1,e.__callback({action:"dragLeave",event:r})))}async function m(r){r.preventDefault();const e=r.currentTarget;await crs.call("dom_interactive","remove_animation_layer"),e.__highlighted=!1;const a=r.dataTransfer.files,t=[];for(const n of a){const l=await d(n.name);t.push({type:n.type,name:l.name,ext:l.ext,size:n.size,value:n})}e.__callback({action:"drop",event:r,results:t})}crs.intent.files=f;export{y as FileFormatter,f as FilesActions,d as get_file_name,h as get_files};
