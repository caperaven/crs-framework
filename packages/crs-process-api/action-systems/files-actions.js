class m{static async perform(e,t,a,n){await this[e.action](e,t,a,n)}static async load(e,t,a,n){if(await crs.process.getValue(e.args.dialog,t,a,n)==!0){const r=await p(e);let i=[];for(const s of r){const o=await u(s.name);i.push({name:o.name,ext:o.ext,type:s.type,size:s.size,value:s})}return e.args.target!=null&&await crs.process.setValue(e.args.target,i,t,a,n),i}else{const r=await y(e,t,a,n);return e.args.target!=null&&await crs.process.setValue(e.args.target,r,t,a,n),r}}static async save(e,t,a,n){const c=await crs.process.getValue(e.args.details,t,a,n);let r=document.createElement("a");r.style.display="none",document.body.appendChild(r);for(let i of c){let s=new Blob([i.value],{type:i.type}),o=window.URL.createObjectURL(s);r.href=o,r.download=`${i.name}.${i.ext}`,r.click(),window.URL.revokeObjectURL(o),o=null,s=null}r.parentElement.removeChild(r),r=null}static async save_canvas(e,t,a,n){const c=await crs.dom.get_element(e.args.source),r=await crs.process.getValue(e.args.name,t,a,n)||"image",i=c.toDataURL("image/png");let s=document.createElement("a");s.style.display="none",document.body.appendChild(s),s.href=i.replace("image/png","image/octet-stream"),s.download=`${r}.png`,s.click(),s.parentElement.removeChild(s),s=null}static async enable_dropzone(e,t,a,n){const c=await crs.dom.get_element(e.args.element,t,a,n),r=await crs.process.getValue(e.args.callback,t,a,n);c.addEventListener("drop",f),c.addEventListener("dragover",d),c.addEventListener("dragleave",g),c.__callback=r}static async disable_dropzone(e,t,a,n){const c=await crs.dom.get_element(e.args.element,t,a,n);c.removeEventListener("drop",f),c.removeEventListener("dragover",d),c.removeEventListener("dragleave",g),delete c.__callback}}class w{static async blob(e){return new Promise(t=>{const a=new FileReader;a.onload=()=>{a.onload=null,t(a.result)},a.readAsArrayBuffer(e)})}}async function u(l){const e=l.split("/"),a=e[e.length-1].split("."),n=a[a.length-1];return{name:a[0],ext:n}}async function p(){return new Promise(l=>{let e=document.createElement("input");e.type="file",e.setAttribute("multiple","multiple"),e.onchange=()=>{e.onchange=null;const t=Array.from(e.files);l(t)},e.click()})}async function y(l,e,t,a){const n=await crs.process.getValue(l.args.files,e,t,a),c=[];for(const r of n){const i=await u(r);c.push({name:i.name,ext:i.ext,value:await fetch(r).then(s=>s.blob())})}return c}async function d(l){l.preventDefault(),l.currentTarget.__callback({action:"dragOver",event:l})}async function g(l){l.preventDefault(),l.currentTarget.__callback({action:"dragLeave",event:l})}async function f(l){l.preventDefault();const e=l.dataTransfer.files,t=[];for(const a of e){const n=await u(a.name);t.push({type:a.type,name:n.name,ext:n.ext,size:a.size,value:a})}l.currentTarget.__callback({action:"drop",event:l,results:t})}crs.intent.files=m;export{w as FileFormatter,m as FilesActions,u as get_file_name,y as get_files};
